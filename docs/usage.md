# Crawley User's Manual
## Telegram
Crawley beholds your Telegram channel and makes all the changes that you perform in the channel including post edits. Just post to your channel as you usually do, Crawley will follow you. The only exception is message removal: Telegram API does not send any update event when you delete the message, see [Post Removal](#post-removal). Crawley also downloads pictures, voice messages and music that you post. It saves them on the server, links to the posts and generates links to them when using its [API](#api).
### Post Removal
Telegram servers do not send update events when you delete messages from the channel. As the result Crawley does not remove posts from its database. To keep your channel and Crawley's database synced **do not remove messages directly**. Instead, edit the message you want to remove and replace its content to `-` (minus sign). Crawley will remove both posts in its database and the connected channel. To remove a picture, a music file or a voice message edit their captions.

## RSS
Crawley generates and sends simple syndication feeds known as RSS. To get it, just perform a GET request to `/rss.xml` of your Crawley installation. It supports attachments as well.

## API
Crawley provides a simple API to get the posts from its database. Just make a GET request at `/post` endpoint and Crawley will respond you with a JSON object of the posts. Posts are sorted by timestamp in an descending order. You also can add `amount` and `offset` parameters for pagination purposes: `amount` limits the maximal amount of returned posts, `offset` skips posts. If `CONTENT_SHOW_ALL` is set to false, a `channel` parameter is required.
The most complicated request will look like this:
```
https://example.com/crawley/post?amount=10&offset=32&channel=-31337420228
```

Or, for a single post (`channel` is mandatory independently from `CONTENT_SHOW_ALL`):
```
https://example.com/crawley/post?channel=-31337420228&post=32
```

The structure of the returned object looks like this (both for single or multiple posts):
```
{
    "status": 0,
    "payload": {
        "position": 0,
        "total": 3,
        "posts": [{
            "id": "-31337_3",
            "timestamp": 1541338726,
            "text": "And this is the second!"
        }, {
            "id": "-31337_2",
            "timestamp": 1541243396,
            "text": "Oh, a voice message!",
            "attachment": {
                "id": 33,
                "type": "voice",
                "url": "https:\/\/example.com\/crawley\/content\/voice\/b96afc80ab3b4abc1be45b46f0b351ea.oga"
            }
        }, {
            "id": "-31337_1",
            "timestamp": 1541242422,
            "text": "This is the first post!"
        }]
    }
}
```
The following table describe every JSON (sub)object of Crawley's responses.
### JSON Structure Description
#### Root object
| Key | Description |
| ------------ | ------------ |
| `status` | Return status, `0` is OK, otherwise look the "Status codes" table |
| `payload` | If `status` is 0, `payload` is a JSON object, otherwise it's a description string |

#### Payload object
| Key | Description |
| ------------ | ------------ |
| `position` | An integer value of skipped posts, may be used for pagination |
| `total` | Total amount of posts, can be used for pagination |
| `posts` | Array of JSON object, every object represents a single post |

#### Post object
| Key | Description |
| ------------ | ------------ |
| `id` | Unique ID of the post. Consists of Channel ID and Message ID sent by Telegram |
| `timestamp` | UNIX timestamp of the post. Generated by the server |
| `text` | *(optional)* Post text. Can be string or `null` if there is no text |
| `attachment` | *(optional)*  JSON objects of the attached media |

#### Attachment object
| Key | Description |
| ------------ | ------------ |
| `id` | Unique ID of the attachment. Generated internally |
| `type` | Attachment type. Can be `photo`, `voice` or `audio` |
| `meta` | Attachment metadata like artist and title (applicable to `audio` attaches only) |
| `url` | Full URL pointing to the attachment content |

#### Status codes
| Code | Description |
| ------------ | ------------ |
| 0 | OK, process `payload` object |
| 1 | Too many posts requested, `amount` value exceeds `CONTENT_MAX_AMOUNT` setting |
| 2 | No records, either database is empty or `offset` is too big |
| 3 | Bad `offset` or `amount` values |
| 4 | No `channel` set (when required) |
| 5 | Bad `post` parameter (should be a positive integer) |